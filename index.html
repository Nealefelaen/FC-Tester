<html>
 <head>
  <title>FC Tester</title>
  <style type = "text/css">
   .label
   {
    width: 245px;
    height: 20px;
    float: left;
    text-align: right;
   }
   .input
   {
    width: 245px;
    height: 20px;
    float: right;
    text-align: left;
   } 
  </style>
  <script language="javascript">
   var FCs = [];
   var randomnumber = -1;
   var startTime;
   var show_each_times = 2;
   var start_fc = 1;
   var end_fc = 10;
   var x = start_fc;
   var number_of_FCs = (end_fc - start_fc) + 1;
   var fcs_to_show = show_each_times * number_of_FCs;
   var fcs_shown = 0;
   var started = 0;
   var rand_factor = 2;
   var last_randomnumber = -1;
   var l = 0;
   var test_div;

   document.onkeypress = checkKeycode;

   function write_statistics()
   {
    document.getElementById("test").innerHTML = "";
    var temptext;
    started = 0;
     temptext = "<table><tr><td>FC</td>";
     for(var j = 1; j <= show_each_times; j++)
     {
      temptext += "<td>Time " + j + "</td>";
     }
     temptext += "<td>Average Time</td></tr>";
    for(var i = 0; i < number_of_FCs; i++)
    {
     if(FCs[i].number_of_times > 0)
     {
      temptext += "<tr><td>" + FCs[i].fc + "</td>";
      for(var j = 0; j < show_each_times; j++)
      {
       if(j < FCs[i].number_of_times)
       {
        temptext += "<td>" + FCs[i].time_taken[j] + "ms</td>";
       }
       else
       {
        temptext += "<td>-</td>";
       }
      }
      temptext += "<td>" + Math.round(FCs[i].average_time_taken) + "ms</td></tr>";
     }
    }
    temptext += "</table>";
    document.getElementById("result").innerHTML = temptext;
   }
   function page_setup()
   {
    document.getElementById("test").style.fontSize='200px';
    test_div = document.getElementById("test");
   }

   function checkKeycode(e)
   {
    if (started)
    {
     var keycode;
     if (window.event) keycode = window.event.keyCode;
     else if (e) keycode = e.which;
     if(keycode == 32)
     {
      tester();
//      document.getElementById("result").innerHTML += "pressed: "+ l + "<br />";
//      l++;
     }
     else if(keycode == 27) write_statistics();
    }
   }
   function settings_setup()
   {
    start_fc = document.getElementById("start_fc").value
    end_fc = document.getElementById("end_fc").value
    show_each_times = document.getElementById("show_each_times").value

    number_of_FCs = (end_fc - start_fc) + 1;
    fcs_to_show = show_each_times * number_of_FCs;
    x = start_fc;

    for(var i=0; i<number_of_FCs; i++)
    {
     FCs[i] = {fc: x, number_of_times: 0, time_taken: [0], average_time_taken: 0, total_time_taken: 0};
     x++;
    }
    
   }
   function tester()
   {
    if(randomnumber != -1)
    {
     var n = new Date();
     var s = n.getTime();
     var diff = s - startTime;
     if(diff > 100) // javascript can screw up sometimes and give a false time of less than 100ms (spamming a button is ~130ms)
     {
      FCs[randomnumber].time_taken[FCs[randomnumber].number_of_times-1] = diff;
      FCs[randomnumber].total_time_taken += diff;
      FCs[randomnumber].average_time_taken = FCs[randomnumber].total_time_taken / FCs[randomnumber].number_of_times;
     }
     else // in which case we want to re-show the number to get an accurate time for it
     {
      FCs[randomnumber].number_of_times--;
      fcs_shown--;
     }
//     document.getElementById("result").innerHTML += FCs[randomnumber].number_of_times + '<br />';
     if(fcs_shown >= fcs_to_show)
     {
      write_statistics();
      return 0;
     }
    }
    var k = 0;
    var exit_loop = 0;
    var rand_attempts = 0;
    while(randomnumber == last_randomnumber)
    {
     randomnumber=Math.floor(Math.random()*(number_of_FCs));
     if(FCs[randomnumber].number_of_times >= show_each_times)
     {
      randomnumber=last_randomnumber;
     }
     if(rand_attempts > rand_factor)
     {
      for(var i = 0; i < number_of_FCs; i++)
      {
       if(FCs[i].number_of_times < show_each_times)
       {
        if(i != last_randomnumber)
        {
         randomnumber = i;
         exit_loop = 1;
         break;
        }
        else
        {
         k = i;
        }
       }
      }
      if(exit_loop)
      {
       break;
      }
      randomnumber = k;
      break
     }
     rand_attempts++;
    }
    last_randomnumber = randomnumber;
    FCs[randomnumber].number_of_times++;
    test_div.innerHTML = FCs[randomnumber].fc;
    startTime = new Date().getTime();
    fcs_shown++;
//    document.getElementById("test").innerHTML += FCs[randomnumber].number_of_times;
    
//    alert(randomnumber);
   }
  </script>
 </head>
 <body style="color: white; background: black;" onLoad="page_setup();">
  <div style="position: fixed; text-align: center; width: 100%;" id="test"></div>
  <div style="text-align: center;" id="result">
   <p>Welcome to the FC Tester page</p>
   <p>It's pretty simple to use, change the settings below to the values you want and then press the 'Start!' button. After you've started, press 'spacebar' once you recall the FCs image and the time it took you to recall it will be recorded and the next FC will be shown. After all of the FCs have been shown the number of times set below you will be taken to a statistics page that will show your results.<br /> Good Luck!</p>
   <center><form style='width: 500px;'>
    <span class='label' title='First number in the range of FCs to show'>Start FC: </span><input class='input' id='start_fc' type='text' value=1 /><br />
    <span class='label' title='Last number in the range of FCs to show'>End FC: </span><input class='input' id='end_fc' type='text' value=10 /><br />
    <span class='label' title='Number of times to show each FC'>Number of times to show: </span><input class='input' id='show_each_times' type='text' value=3 /><br />
    <input style='margin-top: 5px;' type="button" value="Start!" onClick="settings_setup(); started=1; document.getElementById('result').innerHTML=''; tester();">
   </form></center>
    <p style='font-size: 0.8em;'>Note: this program isn't feature complete yet, it's a first version - improvements to follow!</p>
  </div>
 </body>
</html>
